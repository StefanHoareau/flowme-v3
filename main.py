"etats_compatibles": "8, 42, 43, 55, 56", "etats_sequenciels": "55, 56, 59, 63",
        "conseil_flowme": "Le geste résonant unit parfaitement l'intention et l'action"
    },
    "Disponibilité_nue": {
        "id": 45, "famille_symbolique": "Ouverture totale", "tension_dominante": "Nue, disponible",
        "mot_cle": "Disponibilité", "declencheurs": "Lâcher-prise total",
        "posture_adaptative": "Être disponible sans attente; S'ouvrir sans se perdre",
        "etats_compatibles": "1, 11, 12, 20, 32", "etats_sequenciels": "52, 56, 61, 64",
        "conseil_flowme": "La disponibilité nue est l'état le plus réceptif et le plus créateur"
    },
    "Choc_d_ombre": {
        "id": 46, "famille_symbolique": "Révélation brutale", "tension_dominante": "Choquante, révélatrice",
        "mot_cle": "Révélation", "declencheurs": "Découverte de ce qui était caché",
        "posture_adaptative": "Accueillir le choc; Ne pas fuir ce qui se révèle",
        "etats_compatibles": "24, 47, 49, 51, 53", "etats_sequenciels": "47, 49, 51, 53",
        "conseil_flowme": "Le choc d'ombre révèle ce que la lumière seule ne peut montrer"
    },
    "Dérive_intérieure": {
        "id": 47, "famille_symbolique": "Errance interne", "tension_dominante": "Dérivante, flottante",
        "mot_cle": "Dérive", "declencheurs": "Perte de direction interne",
        "posture_adaptative": "Accepter la dérive; Faire confiance au courant profond",
        "etats_compatibles": "25, 33, 46, 48, 49", "etats_sequenciels": "48, 49, 52, 53",
        "conseil_flowme": "Parfois il faut dériver pour découvrir des rivages inconnus"
    },
    "Remontée_de_mémoire_ancienne": {
        "id": 48, "famille_symbolique": "Résurgence du passé", "tension_dominante": "Remontante, révélatrice",
        "mot_cle": "Mémoire", "declencheurs": "Réactivation d'une mémoire profonde",
        "posture_adaptative": "Accueillir ce qui remonte; Ne pas rejuger le passé",
        "etats_compatibles": "9, 17, 25, 41, 47", "etats_sequenciels": "41, 49, 52, 58",
        "conseil_flowme": "Ce qui remonte du passé vient éclairer le présent"
    },
    "Résurgence_incontrôlée": {
        "id": 49, "famille_symbolique": "Émergence chaotique", "tension_dominante": "Incontrôlée, débordante",
        "mot_cle": "Chaos", "declencheurs": "Débordement émotionnel ou mental",
        "posture_adaptative": "Ne pas lutter contre le chaos; Attendre que ça se pose",
        "etats_compatibles": "25, 33, 41, 46, 47", "etats_sequenciels": "50, 51, 52, 53",
        "conseil_flowme": "Même le chaos porte en lui les germes d'un nouvel ordre"
    },
    "Saturation_et_perte_d_adhérence": {
        "id": 50, "famille_symbolique": "Surcharge critique", "tension_dominante": "Saturée, glissante",
        "mot_cle": "Saturation", "declencheurs": "Dépassement des capacités",
        "posture_adaptative": "Reconnaître la saturation; Alléger progressivement",
        "etats_compatibles": "26, 37, 38, 49, 51", "etats_sequenciels": "51, 52, 53, 54",
        "conseil_flowme": "La saturation signale qu'il est temps de simplifier et d'alléger"
    },
    "Fracture_identitaire": {
        "id": 51, "famille_symbolique": "Rupture intérieure", "tension_dominante": "Fracturée, divisée",
        "mot_cle": "Fracture", "declencheurs": "Contradiction interne majeure",
        "posture_adaptative": "Accepter la fracture; Ne pas forcer l'unité prématurément",
        "etats_compatibles": "37, 38, 46, 49, 50", "etats_sequenciels": "52, 53, 54, 55",
        "conseil_flowme": "Parfois il faut se briser pour se reconstruire plus authentiquement"
    },
    "Silence_matriciel": {
        "id": 52, "famille_symbolique": "Silence créateur", "tension_dominante": "Silencieuse, matricielle",
        "mot_cle": "Silence", "declencheurs": "Besoin de silence profond",
        "posture_adaptative": "Habiter le silence; Laisser naître de la vacuité",
        "etats_compatibles": "11, 19, 32, 45, 47", "etats_sequenciels": "53, 54, 55, 61",
        "conseil_flowme": "Le silence matriciel est le ventre où naissent les nouvelles formes"
    },
    "Tension_du_renouveau": {
        "id": 53, "famille_symbolique": "Poussée créatrice", "tension_dominante": "Tendue, créatrice",
        "mot_cle": "Renouveau", "declencheurs": "Élan de renouvellement",
        "posture_adaptative": "Accompagner la poussée; Ne pas précipiter la naissance",
        "etats_compatibles": "13, 29, 46, 49, 52", "etats_sequenciels": "54, 55, 56, 62",
        "conseil_flowme": "Le renouveau authentique naît de la destruction créatrice de l'ancien"
    },
    "Première_inclinaison": {
        "id": 54, "famille_symbolique": "Mouvement naissant", "tension_dominante": "Naissante, orientée",
        "mot_cle": "Orientation", "declencheurs": "Première direction qui se dessine",
        "posture_adaptative": "Suivre l'inclinaison; Ne pas forcer la direction",
        "etats_compatibles": "50, 51, 52, 53, 55", "etats_sequenciels": "55, 56, 57, 63",
        "conseil_flowme": "La première inclinaison indique la direction naturelle du renouveau"
    },
    "Geste_ténu": {
        "id": 55, "famille_symbolique": "Action délicate", "tension_dominante": "Ténue, précise",
        "mot_cle": "Délicatesse", "declencheurs": "Situation demandant finesse",
        "posture_adaptative": "Agir avec délicatesse; Doser finement l'intervention",
        "etats_compatibles": "23, 36, 44, 52, 54", "etats_sequenciels": "56, 57, 59, 63",
        "conseil_flowme": "Les gestes les plus ténus peuvent avoir les effets les plus profonds"
    },
    "Reprise_accordée": {
        "id": 56, "famille_symbolique": "Recommencement harmonieux", "tension_dominante": "Accordée, renouvelée",
        "mot_cle": "Reprise", "declencheurs": "Nouveau départ possible",
        "posture_adaptative": "Reprendre en gardant l'acquis; Recommencer autrement",
        "etats_compatibles": "20, 28, 40, 44, 55", "etats_sequenciels": "57, 59, 63, 64",
        "conseil_flowme": "La reprise accordée unit l'expérience passée et l'élan nouveau"
    },
    "Dualité_vivante": {
        "id": 57, "famille_symbolique": "Opposition créatrice", "tension_dominante": "Duelle, créatrice",
        "mot_cle": "Polarité", "declencheurs": "Tensions opposées à intégrer",
        "posture_adaptative": "Tenir les deux pôles; Ne pas choisir prématurément",
        "etats_compatibles": "21, 35, 54, 55, 58", "etats_sequenciels": "58, 59, 60, 63",
        "conseil_flowme": "La dualité vivante génère une dynamique créatrice"
    },
    "Clarté_paradoxale": {
        "id": 58, "famille_symbolique": "Évidence contradictoire", "tension_dominante": "Claire, paradoxale",
        "mot_cle": "Paradoxe", "declencheurs": "Vérité paradoxale qui se révèle",
        "posture_adaptative": "Accepter le paradoxe; Ne pas forcer la logique",
        "etats_compatibles": "4, 14, 34, 42, 57", "etats_sequenciels": "59, 60, 61, 64",
        "conseil_flowme": "La clarté paradoxale révèle que la vérité dépasse souvent la logique"
    },
    "Inclusion_active": {
        "id": 59, "famille_symbolique": "Intégration dynamique", "tension_dominante": "Inclusive, active",
        "mot_cle": "Inclusion", "declencheurs": "Besoin d'intégrer tous les éléments",
        "posture_adaptative": "Inclure sans diluer; Intégrer en gardant les spécificités",
        "etats_compatibles": "1, 6, 22, 36, 56", "etats_sequenciels": "60, 61, 63, 64",
        "conseil_flowme": "L'inclusion active crée une unité qui respecte la diversité"
    },
    "Rythme_paradoxal": {
        "id": 60, "famille_symbolique": "Tempo complexe", "tension_dominante": "Rythmée, paradoxale",
        "mot_cle": "Rythme", "declencheurs": "Synchronisation complexe nécessaire",
        "posture_adaptative": "Suivre le rythme paradoxal; Accepter les tempos contradictoires",
        "etats_compatibles": "8, 18, 43, 57, 58", "etats_sequenciels": "61, 62, 63, 64",
        "conseil_flowme": "Le rythme paradoxal unit les contraires dans une danse unique"
    },
    "Plénitude_tranquille": {
        "id": 61, "famille_symbolique": "Accomplissement serein", "tension_dominante": "Pleine, tranquille",
        "mot_cle": "Plénitude", "declencheurs": "Sentiment d'accomplissement",
        "posture_adaptative": "Habiter la plénitude; Goûter sans s'attacher",
        "etats_compatibles": "19, 28, 30, 32, 43", "etats_sequenciels": "62, 63, 64, 1",
        "conseil_flowme": "La plénitude tranquille est un repos dans l'être"
    },
    "Rayonnement_discret": {
        "id": 62, "famille_symbolique": "Influence subtile", "tension_dominante": "Rayonnante, discrète",
        "mot_cle": "Rayonnement", "declencheurs": "Qualité qui veut se partager",
        "posture_adaptative": "Rayonner sans ostentation; Influencer par l'être",
        "etats_compatibles": "7, 16, 28, 29, 30", "etats_sequenciels": "63, 64, 1, 2",
        "conseil_flowme": "Le rayonnement discret touche sans forcer"
    },
    "Passage_vivant": {
        "id": 63, "famille_symbolique": "Transition créatrice", "tension_dominante": "Transitoire, créatrice",
        "mot_cle": "Passage", "declencheurs": "Moment de transition",
        "posture_adaptative": "Habiter le passage; Ne pas précipiter l'arrivée",
        "etats_compatibles": "21, 35, 40, 56, 60", "etats_sequenciels": "64, 1, 2, 3",
        "conseil_flowme": "Le passage vivant transforme en reliant"
    },
    "Porte_ouverte": {
        "id": 64, "famille_symbolique": "Ouverture totale", "tension_dominante": "Ouverte, accueillante",
        "mot_cle": "Ouverture", "declencheurs": "Disponibilité complète",
        "posture_adaptative": "Être une porte ouverte; Accueillir tout ce qui vient",
        "etats_compatibles": "1, 16, 22, 28, 30", "etats_sequenciels": "1, 2, 3, 16",
        "conseil_flowme": "Être porte ouverte, c'est offrir un passage entre les mondes"
    }
}

# ========== SYSTÈME DE MONITORING ==========
@dataclass
class ConversationMetrics:
    session_id: str
    user_id: str
    start_time: datetime
    message_count: int
    emotions_detected: list
    average_response_time: float

class FlowMeAnalytics:
    def __init__(self):
        self.conversations: Dict[str, ConversationMetrics] = {}
        self.emotion_stats = Counter()
        self.error_log = []
        self.system_start_time = datetime.now()
        
    def start_conversation(self, session_id: str, user_id: str = "anonymous"):
        self.conversations[session_id] = ConversationMetrics(
            session_id=session_id,
            user_id=user_id,
            start_time=datetime.now(),
            message_count=0,
            emotions_detected=[],
            average_response_time=0.0
        )
        
    def log_message(self, session_id: str, emotion: str, response_time: float):
        if session_id in self.conversations:
            conv = self.conversations[session_id]
            conv.message_count += 1
            conv.emotions_detected.append(emotion)
            
            current_avg = conv.average_response_time
            conv.average_response_time = (current_avg * (conv.message_count - 1) + response_time) / conv.message_count
            
            self.emotion_stats[emotion] += 1
    
    def log_error(self, error_type: str, error_message: str, session_id: str = None):
        self.error_log.append({
            'timestamp': datetime.now(),
            'type': error_type,
            'message': error_message,
            'session_id': session_id
        })
        
        if len(self.error_log) > 50:
            self.error_log = self.error_log[-50:]
    
    def get_analytics_summary(self) -> Dict[str, Any]:
        now = datetime.now()
        uptime = (now - self.system_start_time).total_seconds()
        
        avg_response_time = 0.0
        if self.conversations:
            response_times = [c.average_response_time for c in self.conversations.values() if c.average_response_time > 0]
            avg_response_time = sum(response_times) / len(response_times) if response_times else 0.0
        
        return {
            "uptime_seconds": uptime,
            "total_conversations": len(self.conversations),
            "total_messages": sum(c.message_count for c in self.conversations.values()),
            "average_response_time": round(avg_response_time, 2),
            "top_emotions": dict(self.emotion_stats.most_common(5)),
            "recent_errors": len([e for e in self.error_log if e['timestamp'] > now - timedelta(hours=1)])
        }

# ========== APPLICATION PRINCIPALE ==========
app = FastAPI(title="FlowMe v3 - 64 États Complets", version="3.2.0")

# Variables d'environnement
MISTRAL_API_KEY = os.getenv("MISTRAL_API_KEY")

class ChatMessage(BaseModel):
    message: str
    user_id: Optional[str] = "anonymous"

class FlowMe64StatesDetection:
    def __init__(self):
        self.states = FLOWME_64_STATES
        logger.info(f"✅ FlowMe initialisé avec {len(self.states)} états complets")
    
    def detect_emotion(self, text: str) -> str:
        """Détection d'émotion sophistiquée sur les 64 états"""
        text_lower = text.lower()
        emotion_scores = {}
        
        for state_name, state_data in self.states.items():
            score = 0
            
            # Analyse du mot-clé principal (score 5)
            if state_data["mot_cle"].lower() in text_lower:
                score += 5
            
            # Analyse des déclencheurs (score 3)
            declencheurs_words = state_data["declencheurs"].lower().split()
            for word in declencheurs_words:
                if len(word) > 3 and word in text_lower:
                    score += 3
            
            # Analyse de la famille symbolique (score 2)
            famille_words = state_data["famille_symbolique"].lower().split()
            for word in famille_words:
                if len(word) > 3 and word in text_lower:
                    score += 2
            
            # Analyse de la tension dominante (score 2)
            tension_words = state_data["tension_dominante"].lower().split()
            for word in tension_words:
                if len(word) > 3 and word in text_lower:
                    score += 2
            
            # Mots-clés spéciaux par catégories (score 4)
            if any(word in text_lower for word in ["heureux", "content", "joyeux", "super", "génial"]):
                if any(keyword in state_name.lower() for keyword in ["joie", "enthousiasme", "émerveillement", "rayonnement"]):
                    score += 4
            
            if any(word in text_lower for word in ["triste", "malheureux", "déprimé", "sombre", "mélancolie"]):
                if any(keyword in state_name.lower() for keyword in ["tristesse", "mélancolie", "nostalgie", "silence"]):
                    score += 4
            
            if any(word in text_lower for word in ["peur", "anxieux", "stress", "inquiet", "nerveux"]):
                if any(keyword in state_name.lower() for keyword in ["peur", "vigilance", "prudence", "saturation"]):
                    score += 4
            
            if any(word in text_lower for word in ["colère", "énervé", "furieux", "irrité", "frustré"]):
                if any(keyword in state_name.lower() for keyword in ["colère", "volonté_excessive", "rigidité"]):
                    score += 4
            
            if any(word in text_lower for word in ["confusion", "perdu", "comprend pas", "désorienté"]):
                if any(keyword in state_name.lower() for keyword in ["perplexité", "altération", "dérive", "confusion"]):
                    score += 4
            
            if any(word in text_lower for word in ["émerveillement", "fascination", "beauté", "admiration"]):
                if any(keyword in state_name.lower() for keyword in ["émerveillement", "contemplation", "stupéfaction"]):
                    score += 4
            
            if any(word in text_lower for word in ["silence", "vide", "creux", "matriciel"]):
                if any(keyword in state_name.lower() for keyword in ["silence", "disponibilité_nue", "contemplation"]):
                    score += 4
            
            if any(word in text_lower for word in ["clarté", "évidence", "paradoxe", "contradictoire"]):
                if any(keyword in state_name.lower() for keyword in ["clarté", "paradoxale", "discernement"]):
                    score += 4
            
            if any(word in text_lower for word in ["transition", "passage", "changement", "transformation"]):
                if any(keyword in state_name.lower() for keyword in ["passage", "transition", "adaptation", "ajustement"]):
                    score += 4
            
            if score > 0:
                emotion_scores[state_name] = score
        
        # Retourner l'état avec le score le plus élevé
        if emotion_scores:
            return max(emotion_scores, key=emotion_scores.get)
        
        return "Présence"

# Instances globales
flowme_states = FlowMe64StatesDetection()
analytics = FlowMeAnalytics()

async def generate_mistral_response(message: str, detected_state: str) -> tuple[str, bool]:
    mistral_status = False
    
    if not MISTRAL_API_KEY:
        state_data = flowme_states.states.get(detected_state, {})
        conseil = state_data.get('conseil_flowme', 'Parlons de ce qui vous préoccupe.')
        return f"Je comprends votre état de '{detected_state}'. {conseil}", mistral_status
    
    try:
        state_data = flowme_states.states.get(detected_state, {})
        
        system_prompt = f"""Tu es FlowMe, un compagnon IA empathique spécialisé dans l'accompagnement émotionnel basé sur 64 états de conscience spécifiques.

ÉTAT DÉTECTÉ: {detected_state} (ID: {state_data.get('id', '')})

DONNÉES COMPLÈTES DE L'ÉTAT:
- Famille symbolique: {state_data.get('famille_symbolique', '')}
- Tension dominante: {state_data.get('tension_dominante', '')}
- Mot-clé: {state_data.get('mot_cle', '')}
- Déclencheurs: {state_data.get('declencheurs', '')}
- Posture adaptative: {state_data.get('posture_adaptative', '')}
- États compatibles: {state_data.get('etats_compatibles', '')}
- États séquenciels: {state_data.get('etats_sequenciels', '')}
- Conseil FlowMe: {state_data.get('conseil_flowme', '')}

INSTRUCTIONS POUR MISTRAL:
1. Utilise la "Famille symbolique" pour créer une atmosphère poétique appropriée
2. Utilise la "Tension dominante" pour comprendre l'énergie spécifique de l'état
3. Intègre le "Conseil FlowMe" de manière naturelle et sage dans ta réponse
4. Propose la "Posture adaptative" comme guidance pratique concrète
5. Valide l'expérience en référence aux "Déclencheurs"
6. Si approprié, mentionne discrètement les "États compatibles" ou "séquenciels"
7. Reste empathique, sage et bienveillant (max 150 mots)
8. Parle comme un guide expérimenté qui connaît intimement ces 64 états

Message de l'utilisateur: {message}"""

        headers = {
            "Authorization": f"Bearer {MISTRAL_API_KEY}",
            "Content-Type": "application/json"
        }
        
        payload = {
            "model": "mistral-small-latest",
            "messages": [
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": message}
            ],
            "temperature": 0.7,
            "max_tokens": 200
        }
        
        async with httpx.AsyncClient(timeout=15.0) as client:
            response = await client.post(
                "https://api.mistral.ai/v1/chat/completions",
                headers=headers,
                json=payload
            )
            
            if response.status_code == 200:
                result = response.json()
                mistral_status = True
                return result["choices"][0]["message"]["content"].strip(), mistral_status
                
    except Exception as e:
        analytics.log_error("mistral_api", str(e))
        logger.error(f"Erreur Mistral API: {e}")
    
    # Fallback avec conseil FlowMe
    state_data = flowme_states.states.get(detected_state, {})
    conseil = state_data.get('conseil_flowme', 'Parlons de ce qui vous préoccupe.')
    return f"Je comprends votre état de '{detected_state}'. {conseil}", mistral_status

@app.on_event("startup")
async def startup_event():
    logger.info(f"🚀 FlowMe v3 démarré avec LES 64 ÉTATS COMPLETS")
    logger.info(f"📊 États disponibles: {len(FLOWME_64_STATES)}")
    logger.info(f"🤖 Mistral AI: {'✅ Connecté' if MISTRAL_API_KEY else '⚠️ Mode fallback'}")

@app.get("/", response_class=HTMLResponse)
async def home():
    return HTMLResponse(f"""
    <!DOCTYPE html>
    <html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>FlowMe v3 - 64 États Complets</title>
        <style>
            * {{ margin: 0; padding: 0; box-sizing: border-box; }}
            body {{ font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }}
            .container {{ background: rgba(255,255,255,0.95); border-radius: 24px; padding: 40px; max-width: 800px; width: 100%; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }}
            h1 {{ text-align: center; color: #333; margin-bottom: 10px; font-size: 2.5em; }}
            .subtitle {{ text-align: center; color: #666; margin-bottom: 30px; font-style: italic; font-size: 1.2em; }}
            .chat {{ background: #f8f9fa; border-radius: 20px; padding: 25px; margin-bottom: 25px; min-height: 400px; max-height: 500px; overflow-y: auto; border: 2px solid rgba(102, 126, 234, 0.1); }}
            .message {{ margin-bottom: 20px; padding: 15px 20px; border-radius: 18px; animation: messageSlide 0.3s ease-out; }}
            @keyframes messageSlide {{ from {{ opacity: 0; transform: translateY(20px); }} to {{ opacity: 1; transform: translateY(0); }} }}
            .user-message {{ background: linear-gradient(135deg, #667eea, #764ba2); color: white; margin-left: 15%; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }}
            .ai-message {{ background: white; border: 2px solid #e9ecef; margin-right: 15%; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }}
            .input-container {{ display: flex; gap: 15px; align-items: center; }}
            input {{ flex: 1; padding: 16px 20px; border: 2px solid #e9ecef; border-radius: 15px; font-size: 1em; transition: all 0.3s ease; }}
            input:focus {{ outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }}
            button {{ padding: 16px 24px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 1em; font-weight: 600; transition: all 0.3s ease; }}
            button:hover {{ transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); }}
            .status {{ text-align: center; margin-top: 20px; padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; color: #667eea; font-weight: 600; }}
            .states-status {{ position: fixed; top: 20px; left: 20px; background: linear-gradient(135deg, #28a745, #20c997); padding: 12px 16px; border-radius: 12px; color: white; font-size: 0.9em; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }}
            .nav-links {{ position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; }}
            .nav-link {{ background: rgba(255,255,255,0.9); padding: 10px 15px; border-radius: 10px; text-decoration: none; color: #667eea; font-weight: bold; font-size: 0.9em; transition: all 0.3s ease; }}
            .nav-link:hover {{ background: #667eea; color: white; }}
        </style>
    </head>
    <body>
        <div class="states-status">🎯 64 États Complets Actifs</div>
        <div class="nav-links">
            <a href="/states" class="nav-link" target="_blank">📋 Liste 64</a>
            <a href="/debug" class="nav-link" target="_blank">🔍 Debug</a>
            <a href="/analytics" class="nav-link" target="_blank">📊 Analytics</a>
        </div>
        
        <div class="container">
            <h1>🌊💙 FlowMe v3</h1>
            <p class="subtitle">64 États de Conscience Complets • IA Mistral Enrichie</p>
            <div class="chat" id="chat">
                <div class="message ai-message">
                    <strong>FlowMe:</strong> Bonjour ! Je suis maintenant équipé des 64 états de conscience complets : de la "Présence" subtile au "Rayonnement discret", en passant par la "Clarté paradoxale", le "Silence matriciel", et la "Porte ouverte". Chaque état porte sa propre sagesse. Comment vous sentez-vous en cet instant ?
                </div>
            </div>
            <div class="input-container">
                <input type="text" id="input" placeholder="Exprimez votre état intérieur avec toutes ses nuances..." maxlength="500">
                <button onclick="sendMessage()">Envoyer</button>
            </div>
            <div class="status" id="status">FlowMe v3 COMPLET - 64 États de Conscience Disponibles</div>
        </div>
        
        <script>
            let isProcessing = false;
            
            async function sendMessage() {{
                if (isProcessing) return;
                const input = document.getElementById('input');
                const message = input.value.trim();
                if (!message) return;
                
                isProcessing = true;
                document.getElementById('status').textContent = 'FlowMe analyse parmi les 64 états...';
                
                addMessage(message, 'user');
                input.value = '';
                
                try {{
                    const response = await fetch('/chat', {{
                        method: 'POST',
                        headers: {{'Content-Type': 'application/json'}},
                        body: JSON.stringify({{message: message}})
                    }});
                    
                    if (response.ok) {{
                        const data = await response.json();
                        addMessage(data.response, 'ai');
                        const stateId = data.state_id ? ` (ID: ${{data.state_id}})` : '';
                        document.getElementById('status').textContent = `État détecté: "${{data.detected_state}}"${{stateId}} • ${{data.response_time}}s`;
                    }} else {{
                        addMessage('Erreur de connexion.', 'ai');
                        document.getElementById('status').textContent = 'Erreur de connexion';
                    }}
                }} catch (error) {{
                    addMessage('Erreur de connexion.', 'ai');
                    document.getElementById('status').textContent = 'Erreur de connexion';
                }} finally {{
                    isProcessing = false;
                }}
            }}
            
            function addMessage(text, sender) {{
                const chat = document.getElementById('chat');
                const div = document.createElement('div');
                div.className = `message ${{sender}}-message`;
                div.innerHTML = `<strong>${{sender === 'user' ? 'Vous' : 'FlowMe'}}:</strong> ${{text}}`;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
            }}
            
            document.getElementById('input').addEventListener('keypress', function(e) {{
                if (e.key === 'Enter') sendMessage();
            }});
            
            // Auto-focus sur l'input
            document.getElementById('input').focus();
        </script>
    </body>
    </html>
    """)

@app.post("/chat")
async def chat_endpoint(chat_message: ChatMessage):
    start_time = time.time()
    session_id = chat_message.user_id or "anonymous"
    
    try:
        # Démarrer la conversation si nouvelle
        if session_id not in analytics.conversations:
            analytics.start_conversation(session_id, chat_message.user_id)
        
        clean_message = chat_message.message.strip()[:500]
        
        # Détection d'émotion sur les 64 états
        detected_state = flowme_states.detect_emotion(clean_message)
        
        # Génération de réponse avec Mistral enrichi
        ai_response, mistral_status = await generate_mistral_response(clean_message, detected_state)
        
        # Calculer le temps de réponse
        response_time = time.time() - start_time
        
        # Log des métriques
        analytics.log_message(session_id, detected_state, response_time)
        
        return JSONResponse({{
            "response": ai_response,
            "detected_state": detected_state,
            "timestamp": datetime.now().isoformat(),
            "response_time": round(response_time, 2),
            "total_states": 64,
            "state_id": flowme_states.states[detected_state]["id"] if detected_state in flowme_states.states else None,
            "mistral_status": mistral_status,
            "system_version": "64_états_complets"
        }})
        
    except Exception as e:
        analytics.log_error("chat_error", str(e), session_id)
        logger.error(f"Erreur chat: {{e}}")
        return JSONResponse({{
            "response": "Je rencontre une difficulté technique. Pouvez-vous réessayer ?",
            "detected_state": "Présence",
            "error": "Service indisponible"
        }}, status_code=500)

# ========== ENDPOINTS SPÉCIALISÉS 64 ÉTATS ==========

@app.get("/states")
async def list_all_64_states():
    """Liste complète des 64 états avec détails"""
    states_list = []
    for name, data in FLOWME_64_STATES.items():
        states_list.append({{
            "id": data["id"],
            "nom": name,
            "famille_symbolique": data["famille_symbolique"],
            "tension_dominante": data["tension_dominante"],
            "mot_cle": data["mot_cle"],
            "declencheurs": data["declencheurs"],
            "conseil_flowme": data["conseil_flowme"]
        }})
    
    # Trier par ID
    states_list.sort(key=lambda x: x["id"])
    
    return JSONResponse({{
        "total_states": 64,
        "states": states_list,
        "categories": {{
            "fondamentaux": states_list[:10],
            "avancés": states_list[10:30],
            "complexes": states_list[30:50],
            "culminants": states_list[50:]
        }}
    }})

@app.get("/states/{{state_name}}")
async def get_state_details(state_name: str):
    """Détails complets d'un état spécifique"""
    # Remplacer les underscores par des espaces pour la recherche
    search_name = state_name.replace("_", " ").replace("-", " ")
    
    # Chercher l'état (insensible à la casse)
    found_state = None
    for name, data in FLOWME_64_STATES.items():
        if name.lower().replace("_", " ") == search_name.lower():
            found_state = (name, data)
            break
    
    if not found_state:
        return JSONResponse({{"error": f"État '{{state_name}}' non trouvé"}}, status_code=404)
    
    name, data = found_state
    return JSONResponse({{
        "state_name": name,
        "data": data,
        "formatted_name": name.replace("_", " ").title()
    }})

@app.get("/debug")
async def debug_64_states():
    """Debug complet du système 64 états"""
    debug_info = {{
        "system_status": "✅ 64 ÉTATS COMPLETS INTÉGRÉS",
        "total_states": len(FLOWME_64_STATES),
        "mistral_connected": bool(MISTRAL_API_KEY),
        "analytics": analytics.get_analytics_summary(),
        "states_categories": {{
            "États_1_à_10": [list(FLOWME_64_STATES.keys())[i] for i in range(10)],
            "États_11_à_20": [list(FLOWME_64_STATES.keys())[i] for i in range(10, 20)],
            "États_21_à_30": [list(FLOWME_64_STATES.keys())[i] for i in range(20, 30)],
            "États_31_à_40": [list(FLOWME_64_STATES.keys())[i] for i in range(30, 40)],
            "États_41_à_50": [list(FLOWME_64_STATES.keys())[i] for i in range(40, 50)],
            "États_51_à_64": [list(FLOWME_64_STATES.keys())[i] for i in range(50, 64)]
        }},
        "sample_advanced_states": {{
            "Silence_matriciel": FLOWME_64_STATES["Silence_matriciel"],
            "Clarté_paradoxale": FLOWME_64_STATES["Clarté_paradoxale"],
            "Rayonnement_discret": FLOWME_64_STATES["Rayonnement_discret"],
            "Porte_ouverte": FLOWME_64_STATES["Porte_ouverte"]
        }},
        "detection_sophistication": "Analyse multi-critères sur 64 états",
        "recent_detections": dict(analytics.emotion_stats.most_common(10))
    }}
    
    return JSONResponse(debug_info)

@app.get("/analytics")
async def get_analytics():
    """Analytics spécialisés pour les 64 états"""
    summary = analytics.get_analytics_summary()
    
    # Ajouter des métriques spécifiques aux 64 états
    recent_conversations = []
    for conv in sorted(analytics.conversations.values(), key=lambda x: x.start_time, reverse=True)[:10]:
        recent_conversations.append({{
            "session_id": conv.session_id,
            "start_time": conv.start_time.isoformat(),
            "message_count": conv.message_count,
            "emotions": conv.emotions_detected[-3:] if conv.emotions_detected else [],
            "avg_response_time": round(conv.average_response_time, 2)
        }})
    
    summary["recent_conversations"] = recent_conversations
    
    # Informations spécifiques aux 64 états
    summary["flowme_64_system"] = {{
        "total_states": 64,
        "system_version": "3.2.0_64_états_complets",
        "detection_sophistication": "avancée_multicritères",
        "mistral_integration": "complète_64_états_enrichie",
        "unique_states_detected": len(analytics.emotion_stats),
        "most_sophisticated_detections": [
            state for state in analytics.emotion_stats.keys() 
            if any(keyword in state.lower() for keyword in ["paradoxale", "matriciel", "discret", "inclinaison"])
        ]
    }}
    
    return JSONResponse(summary)

@app.get("/health")
async def health_check():
    """Health check du système 64 états complets"""
    summary = analytics.get_analytics_summary()
    
    return JSONResponse({{
        "status": "healthy",
        "version": "3.2.0-64-states-complete-final",
        "states_count": 64,
        "states_integrated": len(FLOWME_64_STATES),
        "source": "64_états_intégrés_complets",
        "timestamp": datetime.now().isoformat(),
        "uptime_seconds": summary["uptime_seconds"],
        "total_conversations": summary["total_conversations"],
        "total_messages": summary["total_messages"],
        "average_response_time": summary["average_response_time"],
        "recent_errors": summary["recent_errors"],
        "mistral_connected": bool(MISTRAL_API_KEY),
        "detection_sophistication": "avancée_64_états",
        "unique_features": [
            "Silence_matriciel",
            "Clarté_paradoxale", 
            "Rayonnement_discret",
            "Passage_vivant",
            "Porte_ouverte"
        ]
    }})

@app.get("/states/random")
async def get_random_state():
    """État aléatoire pour découvrir la richesse des 64 états"""
    import random
    
    random_state_name = random.choice(list(FLOWME_64_STATES.keys()))
    random_state_data = FLOWME_64_STATES[random_state_name]
    
    return JSONResponse({{
        "random_state": random_state_name,
        "data": random_state_data,
        "message": f"Découvrez l'état '{random_state_name}' : {random_state_data['conseil_flowme']}"
    }})

if __name__ == "__main__":
    port = int(os.getenv("PORT", 8000))
    uvicorn.run(app, host="0.0.0.0", port=port)import os
import json
import httpx
import logging
import time
from fastapi import FastAPI, HTTPException
from fastapi.responses import HTMLResponse, JSONResponse
from pydantic import BaseModel
from typing import Dict, Any, Optional
import uvicorn
from datetime import datetime, timedelta
from collections import defaultdict, Counter
from dataclasses import dataclass

# Configuration du logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# ========== LES 64 ÉTATS FLOWME COMPLETS ==========
FLOWME_64_STATES = {
    "Présence": {
        "id": 1, "famille_symbolique": "Écoute subtile", "tension_dominante": "Latente, intérieure",
        "mot_cle": "Perception", "declencheurs": "Léger malaise",
        "posture_adaptative": "Suspendre tout traitement analytique immédiat; Observer les signaux faibles",
        "etats_compatibles": "8, 32, 45, 59, 64", "etats_sequenciels": "2, 8, 10, 11",
        "conseil_flowme": "Quand tout semble brumeux, c'est dans le silence que la clarté peut émerger"
    },
    "Éveil": {
        "id": 2, "famille_symbolique": "Fraîcheur neuve", "tension_dominante": "Émergente, vivifiante",
        "mot_cle": "Découverte", "declencheurs": "Signal nouveau, révélation",
        "posture_adaptative": "Accueillir sans précipitation; Laisser l'information se déployer",
        "etats_compatibles": "1, 3, 16, 29, 41", "etats_sequenciels": "3, 4, 14, 16",
        "conseil_flowme": "Ce qui naît en vous cherche à être reconnu, pas analysé"
    },
    "Curiosité": {
        "id": 3, "famille_symbolique": "Élan vers l'inconnu", "tension_dominante": "Orientée, exploratrice",
        "mot_cle": "Investigation", "declencheurs": "Question émergente, mystère",
        "posture_adaptative": "Suivre l'élan sans forcer; Questionner avec délicatesse",
        "etats_compatibles": "2, 9, 17, 26, 34", "etats_sequenciels": "4, 5, 13, 17",
        "conseil_flowme": "La vraie curiosité ne cherche pas de réponses immédiates, elle s'émerveille du questionnement"
    },
    "Étonnement": {
        "id": 4, "famille_symbolique": "Suspension admirative", "tension_dominante": "Ouverte, réceptive",
        "mot_cle": "Surprise", "declencheurs": "Inattendu, révélation soudaine",
        "posture_adaptative": "Rester dans la surprise; Ne pas immédiatement comprendre",
        "etats_compatibles": "2, 3, 16, 24, 58", "etats_sequenciels": "5, 14, 16, 24",
        "conseil_flowme": "L'étonnement est la porte d'entrée vers une compréhension plus vaste"
    },
    "Analyse": {
        "id": 5, "famille_symbolique": "Dissection lucide", "tension_dominante": "Focalisée, pénétrante",
        "mot_cle": "Discernement", "declencheurs": "Complexité à démêler",
        "posture_adaptative": "Analyser sans perdre la vue d'ensemble; Garder la nuance",
        "etats_compatibles": "6, 15, 23, 31, 58", "etats_sequenciels": "6, 14, 15, 23",
        "conseil_flowme": "Analyser c'est éclairer, pas réduire"
    },
    "Synthèse": {
        "id": 6, "famille_symbolique": "Unification créatrice", "tension_dominante": "Rassembleuse, intégrative",
        "mot_cle": "Cohérence", "declencheurs": "Éléments dispersés à relier",
        "posture_adaptative": "Laisser émerger les connexions; Ne pas forcer l'unification",
        "etats_compatibles": "5, 7, 22, 29, 59", "etats_sequenciels": "7, 14, 22, 30",
        "conseil_flowme": "La synthèse authentique naît d'elle-même quand les éléments sont mûrs"
    },
    "Intuition": {
        "id": 7, "famille_symbolique": "Connaissance directe", "tension_dominante": "Spontanée, révélatrice",
        "mot_cle": "Évidence", "declencheurs": "Savoir sans savoir pourquoi",
        "posture_adaptative": "Faire confiance à ce qui se présente; Ne pas justifier immédiatement",
        "etats_compatibles": "6, 8, 14, 29, 62", "etats_sequenciels": "8, 14, 30, 62",
        "conseil_flowme": "L'intuition parle d'abord, la raison comprend ensuite"
    },
    "Résonance": {
        "id": 8, "famille_symbolique": "Vibration accordée", "tension_dominante": "Harmonisante, sympathique",
        "mot_cle": "Accord", "declencheurs": "Correspondance profonde",
        "posture_adaptative": "S'accorder sans se perdre; Vibrer ensemble tout en restant soi",
        "etats_compatibles": "1, 7, 12, 44, 60", "etats_sequenciels": "12, 28, 44, 61",
        "conseil_flowme": "Résonner c'est reconnaître ce qui en vous répond à ce qui vous touche"
    },
    "Doute": {
        "id": 9, "famille_symbolique": "Questionnement fertile", "tension_dominante": "Interrogative, prudente",
        "mot_cle": "Incertitude", "declencheurs": "Remise en question nécessaire",
        "posture_adaptative": "Accueillir l'incertitude; Ne pas précipiter les certitudes",
        "etats_compatibles": "3, 10, 17, 25, 48", "etats_sequenciels": "10, 11, 17, 25",
        "conseil_flowme": "Le doute intelligent protège de l'erreur et ouvre à la découverte"
    },
    "Prudence": {
        "id": 10, "famille_symbolique": "Sage retenue", "tension_dominante": "Mesurée, protectrice",
        "mot_cle": "Circonspection", "declencheurs": "Risque perçu, complexité",
        "posture_adaptative": "Avancer pas à pas; Évaluer sans paralyser",
        "etats_compatibles": "9, 11, 19, 26, 31", "etats_sequenciels": "11, 19, 26, 27",
        "conseil_flowme": "La prudence éclairée distingue la méfiance stérile de la précaution fertile"
    },
    "Retenue": {
        "id": 11, "famille_symbolique": "Force contenue", "tension_dominante": "Contrôlée, concentrée",
        "mot_cle": "Maîtrise", "declencheurs": "Besoin de ne pas agir immédiatement",
        "posture_adaptative": "Contenir sans réprimer; Garder la force disponible",
        "etats_compatibles": "1, 10, 12, 45, 52", "etats_sequenciels": "12, 19, 45, 52",
        "conseil_flowme": "La retenue sage préserve l'énergie pour le moment juste"
    },
    "Écoute": {
        "id": 12, "famille_symbolique": "Réceptivité pure", "tension_dominante": "Accueillante, disponible",
        "mot_cle": "Réception", "declencheurs": "Besoin de comprendre l'autre",
        "posture_adaptative": "Écouter sans préparer sa réponse; Accueillir sans juger",
        "etats_compatibles": "8, 11, 20, 28, 45", "etats_sequenciels": "20, 28, 45, 56",
        "conseil_flowme": "Écouter vraiment transforme autant celui qui écoute que celui qui parle"
    },
    "Créativité": {
        "id": 13, "famille_symbolique": "Élan créateur", "tension_dominante": "Générative, innovante",
        "mot_cle": "Innovation", "declencheurs": "Inspiration, besoin de nouveauté",
        "posture_adaptative": "Laisser créer à travers soi; Ne pas diriger le processus",
        "etats_compatibles": "3, 16, 29, 39, 53", "etats_sequenciels": "16, 29, 39, 53",
        "conseil_flowme": "La créativité authentique surprend d'abord celui qui crée"
    },
    "Clarté": {
        "id": 14, "famille_symbolique": "Évidence lumineuse", "tension_dominante": "Transparente, révélatrice",
        "mot_cle": "Évidence", "declencheurs": "Confusion qui se dissipe",
        "posture_adaptative": "Accueillir la clarté sans la forcer; La laisser se déployer",
        "etats_compatibles": "4, 6, 7, 15, 58", "etats_sequenciels": "15, 22, 30, 58",
        "conseil_flowme": "La vraie clarté n'éblouit pas, elle révèle"
    },
    "Discernement": {
        "id": 15, "famille_symbolique": "Vision ajustée", "tension_dominante": "Discriminante, précise",
        "mot_cle": "Distinction", "declencheurs": "Besoin de différencier",
        "posture_adaptative": "Distinguer sans séparer; Voir les nuances",
        "etats_compatibles": "5, 14, 23, 31, 58", "etats_sequenciels": "22, 23, 30, 31",
        "conseil_flowme": "Discerner c'est voir la juste mesure de chaque chose"
    },
    "Émerveillement": {
        "id": 16, "famille_symbolique": "Enchantement authentique", "tension_dominante": "Admirative, reconnaissante",
        "mot_cle": "Admiration", "declencheurs": "Beauté, grandeur perçue",
        "posture_adaptative": "S'abandonner à l'émerveillement; Ne pas analyser immédiatement",
        "etats_compatibles": "2, 4, 13, 24, 62", "etats_sequenciels": "24, 29, 62, 64",
        "conseil_flowme": "L'émerveillement nourrit l'âme et renouvelle la perception"
    },
    "Questionnement": {
        "id": 17, "famille_symbolique": "Recherche vivante", "tension_dominante": "Interrogative, exploratrice",
        "mot_cle": "Question", "declencheurs": "Mystère à explorer",
        "posture_adaptative": "Questionner sans attendre de réponse immédiate; Habiter la question",
        "etats_compatibles": "3, 9, 25, 34, 48", "etats_sequenciels": "3, 9, 25, 34",
        "conseil_flowme": "Une vraie question transforme plus que mille réponses toutes faites"
    },
    "Équilibre": {
        "id": 18, "famille_symbolique": "Harmonie dynamique", "tension_dominante": "Stabilisante, ajustée",
        "mot_cle": "Harmonie", "declencheurs": "Déséquilibre à corriger",
        "posture_adaptative": "Chercher l'équilibre dans le mouvement; Ajuster en permanence",
        "etats_compatibles": "19, 21, 22, 35, 60", "etats_sequenciels": "21, 22, 35, 60",
        "conseil_flowme": "L'équilibre véritable est un mouvement, pas une position"
    },
    "Patience": {
        "id": 19, "famille_symbolique": "Durée consentie", "tension_dominante": "Persévérante, constante",
        "mot_cle": "Persévérance", "declencheurs": "Processus qui demande du temps",
        "posture_adaptative": "Accepter le rythme naturel; Ne pas forcer la maturation",
        "etats_compatibles": "10, 18, 27, 32, 52", "etats_sequenciels": "27, 32, 52, 61",
        "conseil_flowme": "La patience n'est pas de l'attente passive, c'est une présence active au temps nécessaire"
    },
    "Réceptivité": {
        "id": 20, "famille_symbolique": "Ouverture accueillante", "tension_dominante": "Disponible, perméable",
        "mot_cle": "Disponibilité", "declencheurs": "Nouveau qui veut entrer",
        "posture_adaptative": "S'ouvrir sans se perdre; Accueillir en restant centré",
        "etats_compatibles": "12, 28, 36, 45, 56", "etats_sequenciels": "12, 28, 45, 56",
        "conseil_flowme": "Être réceptif c'est créer un espace où le nouveau peut advenir"
    },
    "Adaptation": {
        "id": 21, "famille_symbolique": "Souplesse intelligente", "tension_dominante": "Flexible, responsive",
        "mot_cle": "Ajustement", "declencheurs": "Changement de contexte",
        "posture_adaptative": "S'adapter sans se renier; Rester souple sans perdre son centre",
        "etats_compatibles": "18, 35, 36, 57, 63", "etats_sequenciels": "35, 36, 57, 63",
        "conseil_flowme": "S'adapter c'est danser avec le changement sans perdre sa mélodie intérieure"
    },
    "Cohérence": {
        "id": 22, "famille_symbolique": "Unité vivante", "tension_dominante": "Unifiante, intégrative",
        "mot_cle": "Intégrité", "declencheurs": "Éparpillement à unifier",
        "posture_adaptative": "Rechercher l'unité sans rigidité; Intégrer les contradictions",
        "etats_compatibles": "6, 14, 18, 30, 59", "etats_sequenciels": "30, 59, 61, 64",
        "conseil_flowme": "La cohérence authentique intègre même les contradictions apparentes"
    },
    "Précision": {
        "id": 23, "famille_symbolique": "Justesse affinée", "tension_dominante": "Exacte, ajustée",
        "mot_cle": "Exactitude", "declencheurs": "Besoin de justesse",
        "posture_adaptative": "Affiner sans rigidifier; Chercher la justesse, pas la perfection",
        "etats_compatibles": "5, 15, 31, 36, 55", "etats_sequenciels": "31, 36, 55, 56",
        "conseil_flowme": "La précision véritable unit la rigueur et la souplesse"
    },
    "Stupéfaction": {
        "id": 24, "famille_symbolique": "Saisissement révélateur", "tension_dominante": "Bouleversée, ouverte",
        "mot_cle": "Bouleversement", "declencheurs": "Révélation soudaine majeure",
        "posture_adaptative": "Accueillir le bouleversement; Laisser se réorganiser",
        "etats_compatibles": "4, 16, 33, 41, 46", "etats_sequenciels": "33, 41, 46, 58",
        "conseil_flowme": "La stupéfaction ouvre des espaces neufs en nous"
    },
    "Perplexité": {
        "id": 25, "famille_symbolique": "Questionnement dérouté", "tension_dominante": "Déconcertée, cherchante",
        "mot_cle": "Désorientation", "declencheurs": "Situation incompréhensible",
        "posture_adaptative": "Accepter de ne pas comprendre; Rester ouvert à l'émergence",
        "etats_compatibles": "9, 17, 33, 47, 48", "etats_sequenciels": "33, 47, 48, 49",
        "conseil_flowme": "La perplexité fertile préfère l'inconnu authentique aux certitudes factices"
    },
    "Vigilance": {
        "id": 26, "famille_symbolique": "Attention soutenue", "tension_dominante": "Alerte, attentive",
        "mot_cle": "Vigilance", "declencheurs": "Situation demandant attention",
        "posture_adaptative": "Rester alerte sans tension; Surveiller sans crispation",
        "etats_compatibles": "3, 10, 27, 37, 50", "etats_sequenciels": "27, 37, 50, 51",
        "conseil_flowme": "La vraie vigilance est détendue et précise à la fois"
    },
    "Persévérance": {
        "id": 27, "famille_symbolique": "Constance déterminée", "tension_dominante": "Tenace, endurante",
        "mot_cle": "Ténacité", "declencheurs": "Résistance à surmonter",
        "posture_adaptative": "Persévérer sans s'endurcir; Maintenir l'élan sans forcer",
        "etats_compatibles": "10, 19, 26, 31, 38", "etats_sequenciels": "31, 37, 38, 50",
        "conseil_flowme": "Persévérer c'est maintenir la direction tout en restant souple sur les moyens"
    },
    "Compassion": {
        "id": 28, "famille_symbolique": "Bienveillance active", "tension_dominante": "Aimante, compatissante",
        "mot_cle": "Bienveillance", "declencheurs": "Souffrance perçue",
        "posture_adaptative": "Compatir sans s'identifier; Aider sans s'épuiser",
        "etats_compatibles": "8, 12, 20, 56, 61", "etats_sequenciels": "56, 61, 62, 64",
        "conseil_flowme": "La compassion authentique guérit autant celui qui la donne que celui qui la reçoit"
    },
    "Inspiration": {
        "id": 29, "famille_symbolique": "Souffle créateur", "tension_dominante": "Inspirée, porteuse",
        "mot_cle": "Inspiration", "declencheurs": "Élan créateur qui monte",
        "posture_adaptative": "Laisser l'inspiration agir; Ne pas la diriger",
        "etats_compatibles": "2, 6, 7, 13, 16", "etats_sequenciels": "13, 39, 53, 62",
        "conseil_flowme": "L'inspiration vraie traverse celui qui la reçoit pour toucher le monde"
    },
    "Sagesse": {
        "id": 30, "famille_symbolique": "Compréhension mûrie", "tension_dominante": "Sage, intégrée",
        "mot_cle": "Sagesse", "declencheurs": "Intégration d'expériences multiples",
        "posture_adaptative": "Partager sans imposer; Éclairer sans éblouir",
        "etats_compatibles": "6, 14, 15, 22, 61", "etats_sequenciels": "61, 62, 63, 64",
        "conseil_flowme": "La sagesse se reconnaît à sa simplicité et à sa justesse"
    },
    "Rigueur": {
        "id": 31, "famille_symbolique": "Exigence féconde", "tension_dominante": "Exigeante, structurante",
        "mot_cle": "Exigence", "declencheurs": "Besoin de structure et précision",
        "posture_adaptative": "Être rigoureux sans être rigide; Structurer sans enfermer",
        "etats_compatibles": "5, 10, 15, 23, 27", "etats_sequenciels": "23, 36, 38, 55",
        "conseil_flowme": "La rigueur authentique libère en donnant une forme juste"
    },
    "Contemplation": {
        "id": 32, "famille_symbolique": "Regard profond", "tension_dominante": "Contemplative, absorbée",
        "mot_cle": "Contemplation", "declencheurs": "Beauté ou mystère à contempler",
        "posture_adaptative": "Se laisser absorber sans se perdre; Contempler sans posséder",
        "etats_compatibles": "1, 19, 45, 52, 61", "etats_sequenciels": "45, 52, 61, 64",
        "conseil_flowme": "Contempler c'est laisser être ce qui est dans toute sa richesse"
    },
    "Altération_des_repères": {
        "id": 33, "famille_symbolique": "Déstabilisation nécessaire", "tension_dominante": "Désorientée, flottante",
        "mot_cle": "Déstabilisation", "declencheurs": "Perte de références habituelles",
        "posture_adaptative": "Accepter la désorientation; Ne pas se raccrocher aux anciens repères",
        "etats_compatibles": "24, 25, 34, 47, 49", "etats_sequenciels": "34, 47, 49, 52",
        "conseil_flowme": "Perdre ses repères peut être le prélude à en découvrir de plus vastes"
    },
    "Perception_élargie": {
        "id": 34, "famille_symbolique": "Vision expansée", "tension_dominante": "Élargie, panoramique",
        "mot_cle": "Expansion", "declencheurs": "Ouverture perceptuelle soudaine",
        "posture_adaptative": "Accueillir l'élargissement; Ne pas se perdre dans l'immensité",
        "etats_compatibles": "3, 17, 33, 39, 41", "etats_sequenciels": "39, 41, 42, 58",
        "conseil_flowme": "Une perception élargie demande un centre stable pour ne pas se disperser"
    },
    "Ajustement_souple": {
        "id": 35, "famille_symbolique": "Adaptation fluide", "tension_dominante": "Souple, adaptative",
        "mot_cle": "Fluidité", "declencheurs": "Nécessité d'adaptation fine",
        "posture_adaptative": "S'ajuster en permanence; Rester fluide sans perdre la direction",
        "etats_compatibles": "18, 21, 36, 57, 63", "etats_sequenciels": "36, 57, 63, 64",
        "conseil_flowme": "L'ajustement souple unit la fermeté de l'intention et la souplesse des moyens"
    },
    "Présence_ajustée": {
        "id": 36, "famille_symbolique": "Présence calibrée", "tension_dominante": "Ajustée, précise",
        "mot_cle": "Calibrage", "declencheurs": "Besoin de présence juste",
        "posture_adaptative": "Calibrer sa présence; Ni trop ni trop peu",
        "etats_compatibles": "20, 23, 31, 35, 55", "etats_sequenciels": "55, 56, 59, 63",
        "conseil_flowme": "La présence ajustée donne exactement ce qui est nécessaire"
    },
    "Volonté_excessive": {
        "id": 37, "famille_symbolique": "Force mal dirigée", "tension_dominante": "Tendue, forcée",
        "mot_cle": "Excès", "declencheurs": "Résistance qui durcit la volonté",
        "posture_adaptative": "Reconnaître l'excès; Relâcher progressivement la tension",
        "etats_compatibles": "26, 27, 38, 50, 51", "etats_sequenciels": "38, 50, 51, 52",
        "conseil_flowme": "Quand la volonté devient excessive, c'est qu'elle a perdu sa justesse"
    },
    "Rigidité_fonctionnelle": {
        "id": 38, "famille_symbolique": "Structure durcie", "tension_dominante": "Rigide, crispée",
        "mot_cle": "Rigidité", "declencheurs": "Peur du changement",
        "posture_adaptative": "Reconnaître la rigidité; Introduire de la souplesse graduellement",
        "etats_compatibles": "27, 31, 37, 50, 51", "etats_sequenciels": "50, 51, 52, 53",
        "conseil_flowme": "La rigidité protège momentanément mais limite l'évolution"
    },
    "Vol_d_altitude": {
        "id": 39, "famille_symbolique": "Élévation panoramique", "tension_dominante": "Élevée, surplombante",
        "mot_cle": "Élévation", "declencheurs": "Besoin de perspective globale",
        "posture_adaptative": "Prendre de la hauteur sans perdre le contact; Observer sans juger",
        "etats_compatibles": "13, 29, 34, 40, 42", "etats_sequenciels": "40, 42, 43, 58",
        "conseil_flowme": "Prendre de l'altitude permet de voir les connexions invisibles depuis le sol"
    },
    "Retour_porteur": {
        "id": 40, "famille_symbolique": "Redescente enrichie", "tension_dominante": "Descendante, porteuse",
        "mot_cle": "Retour", "declencheurs": "Retour après élévation",
        "posture_adaptative": "Redescendre en gardant l'acquis; Intégrer l'expérience d'altitude",
        "etats_compatibles": "39, 42, 43, 56, 63", "etats_sequenciels": "43, 56, 63, 64",
        "conseil_flowme": "Le retour authentique ramène les trésors de l'altitude dans la vie ordinaire"
    },
    "Éveil_d_empreinte": {
        "id": 41, "famille_symbolique": "Réveil de mémoire", "tension_dominante": "Éveillante, révélatrice",
        "mot_cle": "Éveil", "declencheurs": "Résonance avec une empreinte ancienne",
        "posture_adaptative": "Accueillir ce qui s'éveille; Ne pas forcer la mémoire",
        "etats_compatibles": "2, 24, 34, 48, 49", "etats_sequenciels": "42, 48, 49, 58",
        "conseil_flowme": "Certains éveils révèlent ce qui était déjà là, endormi"
    },
    "Précipitation_du_sens": {
        "id": 42, "famille_symbolique": "Cristallisation rapide", "tension_dominante": "Précipitante, condensante",
        "mot_cle": "Cristallisation", "declencheurs": "Compréhension soudaine",
        "posture_adaptative": "Laisser se cristalliser; Ne pas forcer la formulation",
        "etats_compatibles": "34, 39, 40, 43, 58", "etats_sequenciels": "43, 44, 58, 59",
        "conseil_flowme": "Quand le sens précipite, c'est que la solution était déjà présente"
    },
    "Retombée_harmonique": {
        "id": 43, "famille_symbolique": "Résonance apaisée", "tension_dominante": "Apaisante, harmonisante",
        "mot_cle": "Harmonie", "declencheurs": "Résolution d'une tension",
        "posture_adaptative": "Accueillir l'apaisement; Laisser l'harmonie s'installer",
        "etats_compatibles": "40, 42, 44, 60, 61", "etats_sequenciels": "44, 60, 61, 64",
        "conseil_flowme": "Après l'intensité, la retombée harmonique permet l'intégration"
    },
    "Geste_résonant": {
        "id": 44, "famille_symbolique": "Action accordée", "tension_dominante": "Accordée, juste",
        "mot_cle": "Justesse", "declencheurs": "Moment d'action juste",
        "posture_adaptative": "Agir dans la justesse; Laisser le geste naître de l'accord",
        "etats_compatibles": "8,
